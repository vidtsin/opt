from odoo import models,fields,api,_
from datetime import datetime, timedelta
from datetime import datetime
from dateutil.relativedelta import relativedelta
from odoo.exceptions import ValidationError
from calendar import Calendar


class crmlead(models.Model):
    _inherit = 'crm.lead'




    name = fields.Char('Opportunity', required=False, invisible=1)





    @api.model
    def retrieve_sales_dashboard(self):
        """ Fetch data to setup Sales Dashboard """

        result = {
            'meeting': {
                'today': 0,
                'next_7_days': 0,
            },
            'activity': {
                'today': 0,
                'overdue': 0,
                'next_7_days': 0,
            },
            'closing': {
                'today': 0,
                'overdue': 0,
                'next_7_days': 0,
            },
            'done': {
                'this_month': 0,
                'last_month': 0,
            },
            'won': {
                'this_month': 0,
                'last_month': 0,
            },



            'new_opportunity':0 ,

            'lost_opportunity':0,

            'opportunity_total':0,

            'prospect_total':0,

            'admitted_total':0,

            'enrolled_total':0,

            'delayed_total': 0,

            'lead_con_ratio':0,

            'lead_to_sales_ratio':0,

            'lead_to_opp_ratio':0,

            'lead_to_opp_ratio1':0,

            # 'lead_to_sale_ratio': 0,
            #
            # 'opp_to_prospect_ratio':0,
            #
            # 'no_follow':0,
            #
            # 'enrolled_last_three_month':0,
            #
            # 'rev_last_three_months': 0,
            #
            # 'rate_last_three_months':0,
            #
            # 'prospect_after_three_month':0,
            #
            # 'rev_after_three_months':0,
            #
            # 'lead_diploma_local_per_weeks':0,
            #
            # 'lead_diploma_inter_per_weeks':0,
            #
            # 'lead_certificate_local_per_weeks':0,
            #
            # 'lead_certificate_inter_per_weeks':0,
            #
            # 'lead_diploma_total_per_weeks':0,
            #
            # 'lead_certification_total_per_weeks':0,
            #
            # 'lead_local_total_per_weeks':0,
            #
            # 'lead_international_total_per_weeks':0,
            #
            # 'lead_grand_total_per_weeks':0,
            #
            # 'oppo_diploma_local_per_weeks':0,
            #
            # 'oppo_diploma_inter_per_weeks': 0,
            #
            # 'oppo_diploma_total_per_weeks': 0,
            #
            # 'oppo_certificate_local_per_weeks': 0,
            #
            # 'oppo_certificate_inter_per_weeks': 0,
            #
            # 'oppo_certification_total_per_weeks': 0,
            #
            # 'oppo_local_total_per_weeks': 0,
            #
            # 'oppo_international_total_per_weeks': 0,
            #
            # 'oppo_grand_total_per_weeks': 0,
            #
            # 'lead_diploma_local_per_months':0,
            #
            # 'lead_diploma_inter_per_months':0,
            #
            # 'lead_certificate_local_per_months':0,
            #
            # 'lead_certificate_inter_per_months':0,
            #
            # 'lead_diploma_total_per_months':0,
            #
            # 'lead_certification_total_per_months':0,
            #
            # 'lead_local_total_per_months':0,
            #
            # 'lead_international_total_per_months':0,
            #
            # 'lead_grand_total_per_months':0,
            #
            # 'oppo_diploma_local_per_months':0,
            #
            # 'oppo_diploma_inter_per_months': 0,
            #
            # 'oppo_diploma_total_per_months': 0,
            #
            # 'oppo_certificate_local_per_months': 0,
            #
            # 'oppo_certificate_inter_per_months': 0,
            #
            # 'oppo_certification_total_per_months': 0,
            #
            # 'oppo_local_total_per_months': 0,
            #
            # 'oppo_international_total_per_months': 0,
            #
            # 'oppo_grand_total_per_months': 0,
            #
            #
            #
            #
            #
            # 'lead_diploma_local_per_year': 0,
            #
            # 'lead_diploma_inter_per_year': 0,
            #
            # 'lead_certificate_local_per_year': 0,
            #
            # 'lead_certificate_inter_per_year': 0,
            #
            # 'lead_diploma_total_per_year': 0,
            #
            # 'lead_certification_total_per_year': 0,
            #
            # 'lead_local_total_per_year': 0,
            #
            # 'lead_international_total_per_year': 0,
            #
            # 'lead_grand_total_per_year': 0,
            #
            # 'oppo_diploma_local_per_year': 0,
            #
            # 'oppo_diploma_inter_per_year': 0,
            #
            # 'oppo_diploma_total_per_year': 0,
            #
            # 'oppo_certificate_local_per_year': 0,
            #
            # 'oppo_certificate_inter_per_year': 0,
            #
            # 'oppo_certification_total_per_year': 0,
            #
            # 'oppo_local_total_per_year': 0,
            #
            # 'oppo_international_total_per_year': 0,
            #
            # 'oppo_grand_total_per_year': 0,




















        }
        current_date=datetime.now()
        lead_gen_date=current_date-relativedelta(days=1)
        opp_gen_date=current_date-relativedelta(days=1)
        new_lead_date=datetime.strftime(lead_gen_date,"%Y-%m-%d")
        new_oppo_date=datetime.strftime(opp_gen_date,"%Y-%m-%d")
        one_year=current_date-relativedelta(years=1)
        one_month=current_date-relativedelta(months=1)
        one_week=current_date-relativedelta(weeks=1)
        bf_three_month=current_date-relativedelta(months=3)
        af_three_month=current_date+relativedelta(months=3)
        af_three_month=current_date+relativedelta(months=3)
        date1=datetime.strftime(one_month,"%Y-%m-%d")
        date2=datetime.strftime(bf_three_month,"%Y-%m-%d")
        date3=datetime.strftime(af_three_month,"%Y-%m-%d")
        date4=datetime.strftime(one_week,"%Y-%m-%d")
        date5=datetime.strftime(one_year,"%Y-%m-%d")


        # #New leads generated records
        #
        # leads=self.search([
        #     ('new_lead','=',True)])
        # if leads:
        #     result['new_leads']=len(leads)
        #
        #
        # # New opportunity generated record
        #
        # opportunitys = self.search([
        #     ('create_date', '>=', date1),
        #     ('new_lead', '!=', True),])
        # if opportunitys:
        #
        #     result['new_opportunity'] = len(opportunitys)
        #
        #
        # #Opportunities records
        #
        # opportunities=self.search([('stage_id.name','=','Opportunity'),('type','!=','lead')])
        # if opportunities:
        #     result['opportunity_total']=len(opportunities)
        #
        # #Prospects records
        #
        # prospects=self.search([('stage_id.name','=','Prospect')])
        # if prospects:
        #     result['prospect_total']=len(prospects)
        #
        #
        # # Admitted  records
        #
        # admitted=self.search([('stage_id.name','=','Admitted')])
        # if admitted:
        #     result['admitted_total']=len(admitted)
        #
        #
        # # Enrolled records
        #
        # enrolled=self.search([('stage_id.name','=','Enrolled')])
        # if enrolled:
        #
        #     result['enrolled_total']=len(enrolled)
        #
        #
        # # Delayed  records
        #
        # delayed=self.search([('stage_id.name','=','Delayed')])
        # if delayed:
        #     result['delayed_total']=len(delayed)
        #
        #
        # # Lost records
        #
        # lost = self.search([('stage_id.name','=','Lost')])
        # if lost:
        #     result['lost_opportunity'] = len(lost)


        # Lead Opportunity Ratio

        leads=self.search([
            ('create_date','>=',date1),
            ('type','=','lead'),
        ])
        ld=len(leads)
        if leads:
            opportunity = self.search([
                ('type','!=','lead'),
                # ('stage_id.name','=','Opportunity'),
            ])
            opp=len(opportunity)
            ratio=str((opp*100)/ld)
            opp_ratio=ratio +'%'
            result['lead_to_opp_ratio']=opp_ratio

        # Lead to Sales Ratio

        leads = self.search([
            ('create_date', '>=', date1),
            ('type', '=', 'lead'),
        ])
        ld = len(leads)
        if leads:
            opportunity = self.search([
                ('type', '!=', 'lead'),
                ('stage_id.name','=','Closed'),
            ])
            sales = len(opportunity)
            ratio = str((sales * 100) / ld)
            sale_ratio = ratio + '%'
            result['lead_to_sales_ratio'] = sale_ratio


        retrieve_dip_data = """select p.product_name,c.type,count(c.id) from crm_lead c join product_detail p on c.product_id = p.id  group by c.type,p.product_name ORDER BY count desc limit 5 ;"""
        self.env.cr.execute(retrieve_dip_data)
        lead_by_diploma = self.env.cr.dictfetchall()
        lead_by_diploma_list=[]
        opportunity = lead = 0
        if lead_by_diploma[0]['type'] == 'opportunity':
            opportunity = lead_by_diploma[0]['count']
        else:
            lead = lead_by_diploma[0]['count']
        first_rec={'product_name':lead_by_diploma[0]['product_name'],'lead':lead,'opportunity':opportunity}
        lead_by_diploma_list.append(first_rec)
        for rec in lead_by_diploma:
            rec_exists=False
            for recs in lead_by_diploma_list:
                if rec['product_name'] ==recs['product_name']:
                    rec_exists=True
                    if rec['type'] == 'opportunity':
                        recs['opportunity'] = rec['count']
                    else:
                        recs['lead'] = rec['count']
            if not rec_exists:
                opportunity = lead = 0
                if rec['type'] == 'opportunity':
                    opportunity = rec['count']
                else:
                    lead = rec['count']
                lead_by_diploma_list.append(
                    {'product_name': rec['product_name'], 'opportunity': opportunity, 'lead': lead})


        if len(lead_by_diploma_list) == 0:
            return '0'
        else:
            print("adasdfsfsdfdsfsd", lead_by_diploma_list)
            result['lead_to_opp_ratio1']= lead_by_diploma_list












        return result




    @api.model
    def retrieve_monthly_lead_product_data(self):
        today = datetime.today()
        months=today-relativedelta(months=1)
        retrieve_mon_lead_product_data="""select p.product_name,count(c.id) from crm_lead c join product_detail p on c.product_id = p.id where type='lead' AND c.create_date >='%s' AND c.create_date <= '%s' group by c.type,p.product_name ORDER BY count desc limit 5 ;"""%(months,today)
        self.env.cr.execute(retrieve_mon_lead_product_data)
        lead_monthly_product=self.env.cr.dictfetchall()
        if len(lead_monthly_product)== 0:
            return 'None'
        else:
            print("adasdfsfsdfdsfsd",lead_monthly_product)
            return lead_monthly_product

    @api.model
    def retrieve_monthly_lead_source_data(self):
        today = datetime.today()
        months = today - relativedelta(months=1)
        retrieve_mon_lead_source_data = """select source_of_lead,count(*) from crm_lead where type='lead' AND create_date >='%s' AND create_date <='%s' group by source_of_lead ORDER BY count desc limit 5;""" % (
        months, today)
        self.env.cr.execute(retrieve_mon_lead_source_data)
        lead_monthly_source = self.env.cr.dictfetchall()
        if len(lead_monthly_source) == 0:
            return 'None'
        else:
            print("adasdfsfsdfdsfsd", lead_monthly_source)
            return lead_monthly_source

    @api.model
    def retrieve_opportunity_product_data(self):

        retrieve_opportunity_product_data = """select p.product_name,count(c.id) from crm_lead c join product_detail p on c.product_id = p.id where type='opportunity' group by c.type,p.product_name ORDER BY count ;"""
        self.env.cr.execute(retrieve_opportunity_product_data)
        opportunity_product = self.env.cr.dictfetchall()
        if len(opportunity_product) == 0:
            return 'None'
        else:
            print("adasdfsfsdfdsfsd", opportunity_product)
            return opportunity_product

    @api.model
    def retrieve_leads_product_data(self):

        retrieve_leads_product_data = """select p.product_name,count(c.id) from crm_lead c join product_detail p on c.product_id = p.id where type='lead' group by c.type,p.product_name ORDER BY count ;"""
        self.env.cr.execute(retrieve_leads_product_data)
        leads_product = self.env.cr.dictfetchall()
        if len(leads_product) == 0:
            return 'None'
        else:
            print("adasdfsfsdfdsfsd", leads_product)
            return leads_product

    @api.model
    def retrieve_healthy_oppo_data(self):

        retrieve_healthy_oppo_data = """select c.stage_id_name,count(c.id) from crm_lead c join product_detail p on c.product_id = p.id where type='opportunity' group by c.type,c.stage_id_name ORDER BY count;"""
        self.env.cr.execute(retrieve_healthy_oppo_data)
        healthy_opportunity = self.env.cr.dictfetchall()
        if len(healthy_opportunity) == 0:
            return 'None'
        else:
            print("adasdfsfsdfdsfsd", healthy_opportunity)
            return healthy_opportunity

    @api.model
    def retrieve_current_month_leads_data(self):
        dict1={}
        current_month=[]


        first_date_month = datetime.today().replace(day=1).strftime('%Y-%m-%d')
        current_date = datetime.today().strftime('%Y-%m-%d')


        retrieve_current_month_leads_data = """select p.product_name,count(c.id) from crm_lead c join product_detail p on c.product_id = p.id where type='lead' group by p.product_name ORDER BY count desc limit 3 ;"""
        self.env.cr.execute(retrieve_current_month_leads_data)
        current_month_data = self.env.cr.dictfetchall()
        count=0
        for item in current_month_data:
            if count==0:
                item.update({"color": "#FF0F00"})
            if count==1:
                item.update({"color": "#F8FF01"})
            if count==2:
                item.update({"color": "#0D52D1"})
            count= count + 1
            if count==3:
                break


        if len(current_month_data) == 0:
            return 'None'
        else:
            print("adasdfsfsdfdsfsd", current_month_data)
            return current_month_data

    @api.model
    def retrieve_current_month_source_data(self):
        dict1 = {}
        current_month = []

        first_date_month = datetime.today().replace(day=1).strftime('%Y-%m-%d')
        current_date = datetime.today().strftime('%Y-%m-%d')

        retrieve_current_month_source_data = """select source_of_lead,count(*) from crm_lead where type='lead' group by source_of_lead ORDER BY count desc limit 3;"""
        self.env.cr.execute(retrieve_current_month_source_data)
        current_month_source_data = self.env.cr.dictfetchall()
        count = 0
        for item in current_month_source_data:
            if count == 0:
                item.update({"color": "#FF0F00"})
            if count == 1:
                item.update({"color": "#F8FF01"})
            if count == 2:
                item.update({"color": "#0D52D1"})
            count = count + 1
            if count == 3:
                break

        if len(current_month_source_data) == 0:
            return 'None'
        else:
            print("adasdfsfsdfdsfsd", current_month_source_data)
            return current_month_source_data

    @api.model
    def retrieve_current_health_opportunity_data(self):
        dict1 = {}
        current_month = []

        first_date_month = datetime.today().replace(day=1).strftime('%Y-%m-%d')
        current_date = datetime.today().strftime('%Y-%m-%d')

        retrieve_current_health_opportunity_data = """select c.stage_id_name,count(c.id) from crm_lead c join product_detail p on c.product_id = p.id where type='opportunity' group by c.type,c.stage_id_name ORDER BY count;"""
        self.env.cr.execute(retrieve_current_health_opportunity_data)
        current_health_oppo_data = self.env.cr.dictfetchall()
        count = 0
        for item in current_health_oppo_data:
            if count == 0:
                item.update({"color": "#FF0F00"})
            if count == 1:
                item.update({"color": "#F8FF01"})
            if count == 2:
                item.update({"color": "#0D52D1"})
            count = count + 1
            if count == 3:
                break

        if len(current_health_oppo_data) == 0:
            return 'None'
        else:
            print("adasdfsfsdfdsfsd", current_health_oppo_data)
            return current_health_oppo_data

    @api.model
    def retrieve_monthly_leads_data(self):

        dict1 = {}
        dict2 = {}
        dict3 = {}
        dict4 = {}
        dict5 = {}
        dict6 = {}
        dict7 = {}
        dict8 = {}
        dict9 = {}
        dict10 = {}
        dict11 = {}
        dict12 = {}
        current_month_leads= []

        current_date = datetime.now()
        month1 = current_date - relativedelta(months=1)
        month_name1 = month1.strftime("%b")
        print month_name1
        month2 = month1 - relativedelta(months=1)
        month_name2 = month2.strftime("%b")

        print month_name2
        month3 = month2 - relativedelta(months=1)
        month_name3 = month3.strftime("%b")
        print month_name3
        month4 = month3 - relativedelta(months=1)
        month_name4 = month4.strftime("%b")
        print  month_name4
        month5 = month4 - relativedelta(months=1)
        month_name5 = month5.strftime("%b")

        print month_name5
        month6 = month5 - relativedelta(months=1)
        month_name6 = month6.strftime("%b")
        print month_name6

        month7 = month6 - relativedelta(months=1)
        month_name7 = month7.strftime("%b")
        print month_name7
        month8 = month7 - relativedelta(months=1)
        month_name8 = month8.strftime("%b")

        print month_name8
        month9 = month8 - relativedelta(months=1)
        month_name9 = month9.strftime("%b")
        print month_name9
        month10 = month9 - relativedelta(months=1)
        month_name10 = month10.strftime("%b")
        print  month_name10
        month11 = month10 - relativedelta(months=1)
        month_name11 = month10.strftime("%b")

        print month_name11
        month12 = month11 - relativedelta(months=1)
        month_name12 = month12.strftime("%b")
        print month_name12

        retrieve_monthly_leads_data1 = """ select p.product_name,count(c.id) from crm_lead c join product_detail p on c.product_id = p.id where type='lead' AND c.create_date >='%s' AND c.create_date<='%s' group by p.product_name ORDER BY count desc limit 2 ;""" % (
        month11, month12)
        print("rettrerjrfoeroeroereor", retrieve_monthly_leads_data1)
        self.env.cr.execute(retrieve_monthly_leads_data1)
        monthly_leads_month1 = self._cr.dictfetchall()
        print("")

        for rec in monthly_leads_month1:
            dict1[rec.get('product_name', False)] = rec.get('count', False)
        var = {"month": month_name12}
        dict1['month'] = var.get('month', False)
        current_month_leads.append(dict1)

        print"diccttttt", dict1

        retrieve_monthly_leads_data2 = """ select p.product_name,count(c.id) from crm_lead c join product_detail p on c.product_id = p.id where type='lead' AND c.create_date >='%s' AND c.create_date<='%s' group by p.product_name ORDER BY count desc limit 2 ;""" % (
            month10, month11)
        print("rettrerjrfoeroeroereor", retrieve_monthly_leads_data2)
        self.env.cr.execute(retrieve_monthly_leads_data2)
        monthly_leads_month2 = self._cr.dictfetchall()

        for rec in monthly_leads_month2:
            dict2[rec.get('product_name', False)] = rec.get('count', False)
        var = {"month": month_name11}
        dict2['month'] = var.get('month', False)
        current_month_leads.append(dict2)

        print"diccttttt", dict2

        retrieve_monthly_leads_data3 = """ select p.product_name,count(c.id) from crm_lead c join product_detail p on c.product_id = p.id where type='lead' AND c.create_date >='%s' AND c.create_date<='%s' group by p.product_name ORDER BY count desc limit 2 ;""" % (
            month9, month10)
        print("rettrerjrfoeroeroereor", retrieve_monthly_leads_data3)
        self.env.cr.execute(retrieve_monthly_leads_data3)
        monthly_leads_month3 = self._cr.dictfetchall()

        for rec in monthly_leads_month3:
            dict3[rec.get('product_name', False)] = rec.get('count', False)
        var = {"month": month_name10}
        dict3['month'] = var.get('month', False)
        current_month_leads.append(dict3)

        print"diccttttt", dict3

        retrieve_monthly_leads_data4 = """ select p.product_name,count(c.id) from crm_lead c join product_detail p on c.product_id = p.id where type='lead' AND c.create_date >='%s' AND c.create_date<='%s' group by p.product_name ORDER BY count desc limit 2 ;""" % (
            month8, month9)
        print("rettrerjrfoeroeroereor", retrieve_monthly_leads_data4)
        self.env.cr.execute(retrieve_monthly_leads_data4)
        monthly_leads_month4 = self._cr.dictfetchall()

        for rec in monthly_leads_month4:
            dict4[rec.get('product_name', False)] = rec.get('count', False)
        var = {"month": month_name9}
        dict4['month'] = var.get('month', False)
        current_month_leads.append(dict4)

        print"diccttttt", dict4

        retrieve_monthly_leads_data5 = """ select p.product_name,count(c.id) from crm_lead c join product_detail p on c.product_id = p.id where type='lead' AND c.create_date >='%s' AND c.create_date<='%s' group by p.product_name ORDER BY count desc limit 2 ;""" % (
            month7, month8)
        print("rettrerjrfoeroeroereor", retrieve_monthly_leads_data5)
        self.env.cr.execute(retrieve_monthly_leads_data5)
        monthly_leads_month5 = self._cr.dictfetchall()

        for rec in monthly_leads_month5:
            dict5[rec.get('product_name', False)] = rec.get('count', False)
        var = {"month": month_name8}
        dict5['month'] = var.get('month', False)
        current_month_leads.append(dict5)

        print"diccttttt", dict5

        retrieve_monthly_leads_data6 = """ select p.product_name,count(c.id) from crm_lead c join product_detail p on c.product_id = p.id where type='lead' AND c.create_date >='%s' AND c.create_date<='%s' group by p.product_name ORDER BY count desc limit 2 ;""" % (
            month6, month7)
        print("rettrerjrfoeroeroereor", retrieve_monthly_leads_data6)
        self.env.cr.execute(retrieve_monthly_leads_data6)
        monthly_leads_month6 = self._cr.dictfetchall()

        for rec in monthly_leads_month6:
            dict6[rec.get('product_name', False)] = rec.get('count', False)
        var = {"month": month_name7}
        dict6['month'] = var.get('month', False)
        current_month_leads.append(dict6)

        print"diccttttt", dict6

        retrieve_monthly_leads_data7 = """ select p.product_name,count(c.id) from crm_lead c join product_detail p on c.product_id = p.id where type='lead' AND c.create_date >='%s' AND c.create_date<='%s' group by p.product_name ORDER BY count desc limit 2 ;""" % (
            month5, month6)
        print("rettrerjrfoeroeroereor", retrieve_monthly_leads_data7)
        self.env.cr.execute(retrieve_monthly_leads_data7)
        monthly_leads_month7 = self._cr.dictfetchall()

        for rec in monthly_leads_month7:
            dict7[rec.get('product_name', False)] = rec.get('count', False)
        var = {"month": month_name6}
        dict7['month'] = var.get('month', False)
        current_month_leads.append(dict7)

        print"diccttttt", dict7

        retrieve_monthly_leads_data8 = """ select p.product_name,count(c.id) from crm_lead c join product_detail p on c.product_id = p.id where type='lead' AND c.create_date >='%s' AND c.create_date<='%s' group by p.product_name ORDER BY count desc limit 2 ;""" % (
            month4, month5)
        print("rettrerjrfoeroeroereor", retrieve_monthly_leads_data8)
        self.env.cr.execute(retrieve_monthly_leads_data8)
        monthly_leads_month8 = self._cr.dictfetchall()

        for rec in monthly_leads_month8:
            dict8[rec.get('product_name', False)] = rec.get('count', False)
        var = {"month": month_name5}
        dict8['month'] = var.get('month', False)
        current_month_leads.append(dict8)

        print"diccttttt", dict8

        retrieve_monthly_leads_data9 = """ select p.product_name,count(c.id) from crm_lead c join product_detail p on c.product_id = p.id where type='lead' AND c.create_date >='%s' AND c.create_date<='%s' group by p.product_name ORDER BY count desc limit 2 ;""" % (
            month3, month4)
        print("rettrerjrfoeroeroereor", retrieve_monthly_leads_data9)
        self.env.cr.execute(retrieve_monthly_leads_data9)
        monthly_leads_month9 = self._cr.dictfetchall()

        for rec in monthly_leads_month9:
            dict9[rec.get('product_name', False)] = rec.get('count', False)
        var = {"month": month_name4}
        dict9['month'] = var.get('month', False)
        current_month_leads.append(dict9)

        print"diccttttt", dict9

        retrieve_monthly_leads_data10 = """ select p.product_name,count(c.id) from crm_lead c join product_detail p on c.product_id = p.id where type='lead' AND c.create_date >='%s' AND c.create_date<='%s' group by p.product_name ORDER BY count desc limit 2 ;""" % (
            month2, month3)
        print("rettrerjrfoeroeroereor", retrieve_monthly_leads_data10)
        self.env.cr.execute(retrieve_monthly_leads_data10)
        monthly_leads_month10 = self._cr.dictfetchall()

        for rec in monthly_leads_month10:
            dict10[rec.get('product_name', False)] = rec.get('count', False)
        var = {"month": month_name3}
        dict10['month'] = var.get('month', False)
        current_month_leads.append(dict10)

        print"diccttttt", dict10

        retrieve_monthly_leads_data11 = """ select p.product_name,count(c.id) from crm_lead c join product_detail p on c.product_id = p.id where type='lead' AND c.create_date >='%s' AND c.create_date<='%s' group by p.product_name ORDER BY count desc limit 2 ;""" % (
            month1, month2)
        print("rettrerjrfoeroeroereor", retrieve_monthly_leads_data11)
        self.env.cr.execute(retrieve_monthly_leads_data11)
        monthly_leads_month11 = self._cr.dictfetchall()

        for rec in monthly_leads_month11:
            dict11[rec.get('product_name', False)] = rec.get('count', False)
        var = {"month": month_name2}
        dict11['month'] = var.get('month', False)
        current_month_leads.append(dict11)

        print"diccttttt", dict11

        retrieve_monthly_leads_data12 = """ select p.product_name,count(c.id) from crm_lead c join product_detail p on c.product_id = p.id where type='lead' AND c.create_date >='%s' AND c.create_date<='%s' group by p.product_name ORDER BY count desc limit 2 ;""" % (
            month1, current_date)
        print("rettrerjrfoeroeroereor", retrieve_monthly_leads_data12)
        self.env.cr.execute(retrieve_monthly_leads_data12)
        monthly_leads_month12 = self._cr.dictfetchall()

        for rec in monthly_leads_month12:
            dict12[rec.get('product_name', False)] = rec.get('count', False)
        var = {"month": month_name1}
        dict12['month'] = var.get('month', False)
        current_month_leads.append(dict12)

        print"diccttttt", dict12

        if len(current_month_leads) == 0:
            return 'None'
        else:
            print "healthhhhhhhhhhhhhhhh", current_month_leads
            # print health_opportunity_inter
            return current_month_leads



