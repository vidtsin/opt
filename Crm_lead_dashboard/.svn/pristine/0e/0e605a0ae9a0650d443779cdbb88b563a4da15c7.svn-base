odoo.define('Crm_lead_dashboard.dashboard', function (require) {
"use strict";

var core = require('web.core');
var QWeb = core.qweb;

var formats = require('web.formats');
var session = require('web.session');
var _t = core._t;
var _lt = core._lt;
var SalesTeamDashboardView = require('sales_team.dashboard');



var lead_by_diploma=[];
var lead_by_certification=[];
var lead_by_month=[];
var lead_by_source=[];



var SalesTeamDashboardView = SalesTeamDashboardView.include({

    display_name: _lt('Dashboard'),
    icon: 'fa-dashboard',
    searchview_hidden: true,
    events: {
        'click .o_dashboard_action': 'on_dashboard_action_clicked',
        'click .o_target_to_set': 'on_dashboard_target_clicked',
            },

    fetch_data: function() {

        return new Model('crm.lead')
            .call('retrieve_sales_dashboard', [], {context: this.session.user_context || {}});


                },

    diptimeoutFunction:function(){
            var chart = AmCharts.makeChart("chartdiv1", {
            "theme": "light",
            "type": "serial",
            "dataProvider": lead_by_diploma,
            "allLabels":{
                  "x": 0,
                  "y": -5,
                  "align": "left",
                },
            "valueAxes": [{
                "axisAlpha": 0,
                "gridAlpha":0,
                "position": "left",
                "labelsEnabled":false,
              }],
            "graphs": [{
                "fillAlphas":1,
                "lineAlpha": 0,
                "type": "column",
                "fillColors":"#FFCE33",
                "valueField":"count",
                "labelsEnabled": false,
            }],
            "rotate": true,
            "categoryField":"program_internal_ref",
            "categoryAxis": {
                "gridPosition":"start",
                "axisAlpha": 0,
                "gridAlpha": 0,
                "position":"left",
                "gridThickness": 0,
                 },
            });
        },




    certitimeoutFunction:function(){
        var chart = AmCharts.makeChart("chartdiv2",{
        "theme": "light",
        "type": "serial",
        "dataProvider": lead_by_certification,
        "valueAxes": [{
                "axisAlpha":0,
                "gridAlpha":0,
                "position":"left",
                "labelsEnabled":false,
              }],
        "graphs": [{
            "fillAlphas":1,
            "lineAlpha": 0,
            "type": "column",
            "fillColors": "#FF7F50",
            "valueField":"count"
        }],
        "rotate": true,
        "categoryField": "program_internal_ref",
        "categoryAxis": {
            "gridPosition":"start",
            "axisAlpha": 0,
            "gridAlpha": 0,
            "position": "left",
            "gridThickness": 0,
             },
        });
    },




    mthtimeoutFunction:function(){
        var chart = AmCharts.makeChart("chartdiv3",{
        "theme":"light",
        "type":"serial",
        "dataProvider":lead_by_month,
        "valueAxes": [{
                "axisAlpha": 0,
                "gridAlpha":0,
                "position": "left",
                "labelsEnabled":false,
              }],
        "graphs": [{
            "fillAlphas":1,
            "lineAlpha": 0,
            "type": "column",
            "fillColors":"#FFCE33",
            "valueField":"count"
        }],
        "rotate": true,
        "categoryField":"month",
        "categoryAxis": {
            "gridPosition":"start",
            "axisAlpha": 0,
            "gridAlpha": 0,
            "position": "left",
            "gridThickness": 0,
             },
        });
    },




    srcitimeoutFunction:function(){
        var chart = AmCharts.makeChart("chartdiv4", {
        "theme": "light",
        "type": "serial",
        "dataProvider": lead_by_source,
        "valueAxes": [{
                "axisAlpha":0,
                "gridAlpha":0,
                "position": "left",
                "labelsEnabled":false,
              }],
        "graphs": [{
            "fillAlphas":1,
            "lineAlpha": 0,
            "type":"column",
            "fillColors": "#FF7F50",
            "valueField":"count",

        }],
        "rotate": true,
        "categoryField":"source_url",
        "categoryAxis": {
            "gridPosition":"start",
            "axisAlpha": 0,
            "gridAlpha": 0,
            "position": "left",
            "gridThickness": 0,
             },
        });
    },




    amcharts_diploma:function(){
        var Model= require('web.Model');
        var crm_model= new Model('crm.lead');
        lead_by_diploma=[]
        var self=this;
        crm_model.call('retrieve_diploma_data').then(function(result)
        {

          if (result == 'None')
              {
                lead_by_diploma=[]
              }
              else
              {
                  for (var i=0; result.length>i; i++)
                  {
                      var title=result[i].internal_ref;
                      var value=result[i].count;
                      lead_by_diploma.push({'program_internal_ref':title,'count':value});
                  };
              }

                setTimeout(function() {self.diptimeoutFunction();},300);

            });
        },





    amcharts_certification:function(){
        var Model= require('web.Model');
        var crm_model= new Model('crm.lead');
        lead_by_certification=[]
        var self=this;
        crm_model.call('retrieve_certification_data').then(function(result)
        {
           if (result == 'None')
              {
                lead_by_certification=[]
              }
              else
              {
                  for (var i=0; result.length>i; i++)
                  {
                      var title=result[i].internal_ref;
                      var value=result[i].count;
                      lead_by_certification.push({'program_internal_ref':title,'count':value});
                      console.log("------%s",value);
                      console.log("------%s",title);
                  };
              }
                setTimeout(function() {self.certitimeoutFunction();},300);

            });
        },





    amcharts_months:function(){
            var Model= require('web.Model');
            var crm_model= new Model('crm.lead');
            lead_by_month=[]
            var self=this
            crm_model.call('retrieve_month_data').then(function(result)
            {
              if (result == 'None')
                  {
                    lead_by_month=[]
                  }
                  else
                  {
                      for (var i=0; result.length>i; i++)
                      {
                          var title=result[i].create_date;
                          var value=result[i].count;
                          lead_by_month.push({'month':title,'count':value});
                      };
                  }
                    setTimeout(function() {self.mthtimeoutFunction();},300);

                });
            },



    amcharts_source:function(){
            var Model= require('web.Model');
            var crm_model= new Model('crm.lead');
            lead_by_source=[]
            var self=this;
            crm_model.call('retrieve_source_data').then(function(result)
            {

              if (result == 'None')
                  {
                    lead_by_source=[]
                  }
                  else
                  {
                      for (var i=0; result.length>i; i++)
                      {
                          var title=result[i].source_url;
                          var value=result[i].count;
                          lead_by_source.push({'source_url':title,'count':value});
                      };
                  }
                    setTimeout(function() {self.srcitimeoutFunction();},300);

                });
               },
//






    render: function() {
        var super_render = this._super;
        var self = this;
        return this.fetch_data().then(function(result){

            self.show_demo = result && result.nb_opportunities === 0;
            var sales_dashboard = QWeb.render('sales_team.SalesDashboard', {
                widget: self,
                show_demo: self.show_demo,
                values: result,
            });
            super_render.call(self);
            $(sales_dashboard).prependTo(self.$el);
            self.amcharts_diploma();
            self.amcharts_certification();
            self.amcharts_source();
            self.amcharts_months();
           });
         },




       });
    });









