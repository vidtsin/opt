from odoo import fields, models, tools,api
from datetime import datetime
from dateutil.relativedelta import relativedelta, MO


class CrmOpportunityReport(models.Model):


    _name = "crm.oppor.report"

    product_id =fields.Many2one('product.detail',string='Products')
    user_id =fields.Many2one('res.users',string='Sales Person')

    @api.multi
    def generate_report(self):
        if not self.product_id:
            if self.user_id != False:
                tree_view = self.env.ref('crm.crm_case_tree_view_oppo')
                form_view = self.env.ref('crm.crm_case_form_view_oppo')
                return {
                    'name': 'View Leads',
                    'type': 'ir.actions.act_window',
                    'src_model': 'crm.oppor.report',
                    'res_model': 'crm.lead',
                    'view_type': 'form',
                    'view_mode': 'tree, form',
                    'views': [
                        (tree_view.id, 'tree'),
                        (form_view.id, 'form')],
                    'view_id': False,
                    'target': 'self',
                    'domain': [
                        # ('faculty_ids', '=', self.filter_faculty_id.id),
                        ('type', '=', 'opportunity'),
                        ('user_id', '=', self.user_id.id),
                        # ('program', '=', self.filter_program_id.id),
                        # ('team_id', '=', self.filter_team_id.id),


                    ],

                }
        if self.product_id != False:
            if not self.user_id:
                tree_view = self.env.ref('crm.crm_case_tree_view_oppo')
                form_view = self.env.ref('crm.crm_case_form_view_oppo')
                return {
                    'name': 'View Leads',
                    'type': 'ir.actions.act_window',
                    'src_model': 'crm.oppor.report',
                    'res_model': 'crm.lead',
                    'view_type': 'form',
                    'view_mode': 'tree, form',
                    'views': [
                        (tree_view.id, 'tree'),
                        (form_view.id, 'form')],
                    'view_id': False,
                    'target': 'self',
                    'domain': [
                        # ('faculty_ids', '=', self.filter_faculty_id.id),
                        ('type', '=', 'opportunity'),
                        ('product_id', '=', self.product_id.id),
                        # ('program', '=', self.filter_program_id.id),
                        # ('team_id', '=', self.filter_team_id.id),


                    ],

                }
        if self.product_id != False:
            if self.user_id != False:
                tree_view = self.env.ref('crm.crm_case_tree_view_oppo')
                form_view = self.env.ref('crm.crm_case_form_view_oppo')
                return {
                    'name': 'View Leads',
                    'type': 'ir.actions.act_window',
                    'src_model': 'crm.oppor.report',
                    'res_model': 'crm.lead',
                    'view_type': 'form',
                    'view_mode': 'tree, form',
                    'views': [
                        (tree_view.id, 'tree'),
                        (form_view.id, 'form')],
                    'view_id': False,
                    'target': 'self',
                    'domain': [
                        ('type', '=', 'opportunity'),
                        ('product_id', '=', self.product_id.id),
                        ('user_id', '=', self.user_id.id),


                    ],

                }